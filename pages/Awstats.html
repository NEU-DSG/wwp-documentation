<?eleventy json
{"layout":"..\/..\/_includes\/page-base.njk","title":"Awstats - WikiBase"}
?>
<main xmlns="http://www.w3.org/1999/xhtml" id="content" class="mw-body">
	<a id="top"></a>
	
	
	<h1 id="firstHeading" class="firstHeading" lang="en">Awstats</h1>
	<div id="bodyContent" class="mw-body-content">
		
		
		
		
		
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><p>[Note: this page is about our conversion from the <em>old</em> awstats system (6.5) to the  <em>new</em> awstats system (7.7) that Syd &amp; Ash are working on as I write this, i.e. summer 2020. We are primarily interested in documenting the new, but want some breadcrumbs or comparisons to the old sometimes, too.]
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading"><input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none" /><div class="toctitle" lang="en" dir="ltr"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#cron_job"><span class="tocnumber">1</span> <span class="toctext">cron job</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#new_paths"><span class="tocnumber">2</span> <span class="toctext">new paths</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#old_paths"><span class="tocnumber">3</span> <span class="toctext">old paths</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Missing_AWStats_data"><span class="tocnumber">4</span> <span class="toctext">Missing AWStats data</span></a></li>
</ul>
</div>

<h2 class="mw-headline" id="cron_job">cron job</h2>
<p>Currently (on production), user root runs a cron job once every 42 hours that executes <code>/var/www/cgi-bin/awstats/awstatsRunAll.sh</code>. We are likely to change that to 24 for the <em>new</em> system.
</p>
<h2 class="mw-headline" id="new_paths">new paths</h2>
<p>“In Unix, 90% of all errors are either paths or permissions.” — Paul Caton, circa 2007.
</p><p>Herein is just a list of the pertinent places as they currently exist on <code>wwp-test</code>, and supposedly will exist on <code>wwp</code> soon.
</p>
<dl><dt><code>/var/log/apache2/</code></dt>
<dd>The log files that are to be analyzed are stored here (and in particular in the <code>HOLD/</code> subdirectory (which used to be called <code>OLD/</code>, but that caused some problems.:-)).</dd>
<dt><code>/usr/share/awstats/</code></dt>
<dd>The installation of awstats itself, as used in our RHEL 6 servers. The main Perl script that powers awstats is in the <code>wwwroot/cgi-bin/</code> subdirectory. The mainstay of local mods have been made in the <code>tools/</code> subdirectory, which is under <a rel="nofollow" class="external text" href="http://liblab.neu.edu/svn/DSG/wwp/webstats/trunk">version control</a>. Note that when <code>generateAndRunAllConfFiles.bash</code> is run by anacron (via the <code>/etc/cron.daily/generateAndRunAllConfFiles.bash</code> symlink) it puts the debugging messages generated by <code>echo</code> into <code>/var/mail/root</code>.</dd>
<dt><code>/usr/local/awstats</code></dt>
<dd>The installation of awstats itself, created by the awstats v7.8 installer on RHEL 8. The main Perl script that powers awstats is in the <code>wwwroot/cgi-bin/</code> subdirectory. The mainstay of local mods have been made in the <code>tools/</code> subdirectory, which is under <a rel="nofollow" class="external text" href="http://liblab.neu.edu/svn/DSG/wwp/webstats/trunk">version control</a>. Note that when <code>generateAndRunAllConfFiles.bash</code> is run by anacron (via the <code>/etc/cron.daily/generateAndRunAllConfFiles.bash</code> symlink) it puts the debugging messages generated by <code>echo</code> into <code>/var/mail/root</code>.</dd>
<dt><code>/var/lib/awstats/</code></dt>
<dd>A directory awstats uses by default, but we do not use it. It may exist, but don’t bother poking around in there for our stuff.</dd>
<dt><code>/var/www/html/usage/awstats/</code></dt>
<dd>The output of the actual awstats command (<code>/usr/share/awstats/wwwroot/cgi-bin/awstats.pl</code>) goes here. It is launched by <code>/usr/share/awstats/tools/runStats.bash</code>, reads in the config file provided as a parameter (which is typically in <code>/etc/awstats/</code>), and writes out these puppies. Note also that we need a copy of index.php here, which we currently handle by symlinking so we can keep it in a directory that is under version control.</dd>
<dt><code>/etc/awstats/</code></dt>
<dd>The configuration files generated by <code>makeConfFiles.pl</code> are stored here. (It, BTW, is run from <code>/usr/share/awstats/tools/generateAndRunAllConfFiles.bash</code>.) If you want to make a change to the configuration files, either change that program or the template file it reads (which is <code>/usr/share/awstats/tools/awstats.wwp.template.conf</code>).</dd></dl>
<h2 class="mw-headline" id="old_paths">old paths</h2>
<ul><li><code>/var/www/cgi-bin/awstats/</code></li>
<li><code>/var/www/cgi-bin/awstats_priv/</code></li>
<li><code>/var/www/awstats/</code> (We’re not 100% about this one.)</li>
<li><code>/etc/awstats/</code></li>
<li><code>/var/www/html/usage/awstatsMain/</code></li>
<li><code>/var/www/html/usage/awstats/</code>
<ul><li>Is symlinked to <code>/var/www/usage/awstats</code>, we don’t know why</li>
<li>has subdir <code>/var/www/html/usage/awstats/cronReports/</code></li></ul></li>
<li><code>/var/log/apache2/</code> (used OLD/ instead of HOLD/ child dir)</li></ul>
<h2 class="mw-headline" id="Missing_AWStats_data">Missing AWStats data</h2>
<p>On 2020-09-08, we copied all awstats<em>MOYEAR</em>.txt files from the backup data files (<code>/mnt/WWPprod-Data/backup_awstats_6.5_stuff_pre-install_7.7_2020-09/2020-09-04T11:04:16/usage/awstats/</code>), to the new institution data folders, AS LONG AS that filename didn't already exist in the target directory. (We used <code>cp -n</code>.) This action gave us AWStats data from before April 2017, augmenting what we already had for April 18, 2017 and onward. This leaves a gap in data from April 1 to 17, 2017.
</p><p>We found that the missing chunk of data from April 2017 <b>was</b> present in the backup directory, but since the 042017 file already existed (i.e., in both the backup and the target directory), it was not copied over and the 04-01–04-17 data was thus not showing up on the web.
</p><p>To test our options, we deleted all Northeastern_University_Private_IPs data from 2017-05 onward. We moved the 042017 data file (which has the data for 2017-04-18 to the end of 2017-04) out of the way (by renaming it), and copied the 042017 data file from the backup (which has the 04-01–04-17 data) into its place. We also changed the name of the "dnscache" file so it would be regenerated. Finally, we re-ran the AWStats generation process on the institution, using <code>/usr/bin/perl /usr/share/awstats/wwwroot/cgi-bin/awstats.pl -config=Northeastern_University_Private_IPs -update</code> (which we copied from <code>/usr/share/awstats/tools/runStats.bash</code> :-).
</p><p>As a result, we retained the data from 04-01–04-17, converted from plaintext to XML format (becaues we’re using XML in 7.7; we had used plain text in 6.5). We did not get the data from 04-18+ back. The institution also did not pick up logged data from May 2017.
</p>
<!-- 
NewPP limit report
Cached time: 20241110131825
Cache expiry: 86400
Dynamic content: false
Complications: []
CPU time usage: 0.018 seconds
Real time usage: 0.019 seconds
Preprocessor visited node count: 12/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 0/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 -total
-->

<!-- Saved in parser cache with key dsgwiki:pcache:idhash:539-0!canonical and timestamp 20241110131825 and revision id 3793
 -->
</div></div><div class="printfooter">Retrieved from "<a dir="ltr" href="https://liblab.neu.edu/mediawik/index.php?title=Awstats&amp;oldid=3793">https://liblab.neu.edu/mediawik/index.php?title=Awstats&amp;oldid=3793</a>"</div>
		
	</div>
</main>